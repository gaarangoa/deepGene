
import sys
import argparse
import json
 

def main():
    parser = argparse.ArgumentParser(description='This program takes the results from the motif finding and parses that file into a json file')
    parser.add_argument('--input', help='input motif generated by FIMO')
    parser.add_argument('--output', help="output json file")
    args = parser.parse_args()

    data = {}
    for i in open(args.input):
        if i[0] == "#": continue
        i = i.split()
        try:
            if data[ (i[0],i[2]) ] < float(i[6]):
                data[ (i[0],i[2]) ] = float(i[6])
        except:
            data[ (i[0],i[2]) ] = float(i[6])

    genes = {}
    for i in data:
        item = {
            "feature_name": i[0],
            "value": data[i]
        } 
        try:
            genes[i[1]].append(item)
        except:
            genes[i[1]] = [item]
    
    del data
    gns = []
    for i in genes:
        gns.append({
            "gene_id": i, 
            "features": genes[i]
        })

    json.dump(gns, open(args.output, "w"))

    print("main", args.input, args.output)